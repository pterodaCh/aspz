# Практична 3
## Завдання 1
У завданні потрібно використати перелічені команди, щоб поекспериментуйте з максимальним лімітом ресурсів відкритих файлів. Потрібно виконати завдання з root-правами та без них.
```
$ ulimit -n
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3000
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3001
$ ulimit -n 2000
$ ulimit -n
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3000
```
##

Спершу виконаємо та подивимося результат команд з root-правами, оскільки це рівень доступу, який користувач отримує автоматично.

```docker run -it dockeraspz bash```

![image](https://github.com/user-attachments/assets/b418b8dd-bf68-4645-90cd-65eb63b57e80)

Ця команда дозволить нам переглянути результат запропонованих команд без root-прав
```docker run -it --user $USER dockeraspz bash```

![image](https://github.com/user-attachments/assets/8d84fcd6-5be1-488e-9897-6ae975cb81a0)

Порівнюючи результати виконання команд, помічаємо, що відмінності відсутні. Скоріше за все у завданні малося на увазі про привілейовані права доступу. Їх можна отримати використовуючи прапорець `--privileged`. Тоді й справді результат різнитиметься

![image](https://github.com/user-attachments/assets/bff620af-8c2f-43b5-85d2-bb3be3d3747d)

## Завдання 2

У Docker-контейнері встановіть утиліту perf(1). Поекспериментуйте з досягненням процесом встановленого ліміту.

##
У документації [seccomp докера](https://docs.docker.com/engine/security/seccomp/) зазначається, що системні виклики “perf*” і “ptrace” заборонено за замовчуванням з міркувань безпеки. Є декілька методів обійти цю заборону. Один з них запустити докер з прапорцем `--privileged`.

Далі потрібно докачати потрібні пакети у яких знаходиться команда `perf`. Встановити потрібну відповідну версію до вашого ядра. Визначаити її можна за допомогою наступної команди
```
uname -r
```
У мене довгий час не виходило розібратися чому убунта не хоче втановлювати певні пакети і не може їх алокувати. Я пробувала різні команди

```
apt install -y linux-tools-5.15.0-1078-iotg
apt-get install -y linux-tools-5.15.0-1078-iotg
apt-get install -y linux-cloud-tools-5.15.0-1078-iotg
apt install -y linux-tools-5.15.0-1078-generic
```
В терміналі, незважаючи на всі мої спроби, всерівно вибивало помилку, яка зазвичай була пов1язана з тим, що неможливо було алокувати пакети.

![image](https://github.com/user-attachments/assets/98c082b0-c531-497a-bbe7-c3488a44c8e4)

Після цього проблеми не зникли, оскільки якщо щось погане має статися воно обов'язково станеться. Для віртуалки не вистачалося місця, а після переміщення файлів на диск d, все взагалі перестало запускатися. Тому, що freebsd, що ubuntu потрібно було видалити та переустановити.

Я не визначила корінь проблеми, проте маю підозру, що це було пов'язано із зістарілою версією ядра, оскільки після оновлення усе запрацювало. Ось описані кроки після запуску докера

```
apt install -y sudo
apt install -y linux-tools-6.8.0-59-generic
sudo perf stat ls

```
Словами не описати як я зраділа цій помилці, адже це значило, що залишилося лише запустити докер в привілейованому стані

![image](https://github.com/user-attachments/assets/1b4a06bd-3165-465d-840c-782fe4d747ce)

```
docker run -it --privileged dockeraspz bash
sudo perf stat ls
```

![image](https://github.com/user-attachments/assets/9e7847c3-32c4-48f7-9f6b-212f198ad271)

Створимо файл з нескінченним циклом `while` для виконання завдання. Для того також потрібно буде доінсталювати gcc та nano.
```
#include <stdio.h>
int main(){
    while(1);
    return 0;
}
```
Скомпілюємо програму та запстимо її. Проте оскільки програма триває нескінченно нам потрібно прервати її, щоб отримати результат.
```
sudo perf stat ./lim
```

![image](https://github.com/user-attachments/assets/a80f944e-b1e9-4bcc-b250-b155cc606059)

## Завдання 3

Напишіть програму, що імітує кидання шестигранного кубика. Імітуйте кидки, результати записуйте у файл, для якого попередньо встановлено обмеження на його максимальний розмір (max file size). Коректно обробіть ситуацію перевищення ліміту.
##
Напишім невеличку [програму](https://github.com/pterodaCh/aspz/blob/main/practice_3/dices.c), яка дозволяє підкидувати кубик n кількість разів та записувати результат у файл [dicelogs.txt](https://github.com/pterodaCh/aspz/tree/main/practice_3). 
![image](https://github.com/user-attachments/assets/11bc683f-f86d-4f0a-99b8-cb17f713336f)
Тепер використаємо знайомі нам команди з першого завдання, для встановлення ліміту та повторимо наші дії знову
```
ulimit -f 1
```
![image](https://github.com/user-attachments/assets/26fed209-c79e-4c36-9dc3-b191951b5cff)

...

![image](https://github.com/user-attachments/assets/98f2e7d3-dd9f-45ff-8b4e-594cb6ad55f7)

## Завдання 4

Напишіть програму, що імітує лотерею, вибираючи 7 різних цілих чисел у діапазоні від 1 до 49 і ще 6 з 36. Встановіть обмеження на час ЦП (max CPU time) і генеруйте результати вибору чисел (7 із 49, 6 із 36). Обробіть ситуацію, коли ліміт ресурсу 
##

## Завдання 7

Встановити обмеження на кількість відкритих сокетів (ulimit -n) та запустити серверну програму.
##

Для виконання цього завдання нам необхідно використати `ulimit -n`, де прапорець -n обмежує кількість одночасно відкритих файлів (дескрипторів файлів).

```
root@de97b76fb94a:/# nano server.c 
root@de97b76fb94a:/# gcc -Wall server.c -o server
root@de97b76fb94a:/# ulimit -n    
100
root@de97b76fb94a:/# ulimit -n 100
root@de97b76fb94a:/# ./server 
```
![image](https://github.com/user-attachments/assets/335d5c0e-a669-4d9a-85f0-8972142424ff)

Насправді ліміти можна змінити!Для цього потрібно змінити конфіг лімітів.
```
cd etc/security
nano limits.conf
```
Будучи у конфізі нам потрібно перейти до низу файлу та додати 4 параметри. 
* domain -визначає користувача, групу або містить символ підстановки (* або %).
* type - приймає два значення - м'який або твердий.
* item - приймає будь-яке значення з перелічених у файлі конфігурації.
* value - цілочисельне значення, виражене в одиницях виміру, пов'язаних з <item>
  
![image](https://github.com/user-attachments/assets/007cbd39-755b-4055-b47f-3ad8e912e8ca)

Оскільки ми працюємо саме з дескрипторами, то під параметром предмету пишемо nofile

![image](https://github.com/user-attachments/assets/5104a20c-5915-44de-9a13-7931fdaaad05)

```
@de97b76fb94a hard nofile 500
@de97b76fb94a soft nofile 500
```
Результат після зміни конфігу:
![image](https://github.com/user-attachments/assets/e6e63a39-cfa3-450e-90c1-1ab3ef8295b7)


