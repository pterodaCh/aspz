# Практична 3
## Завдання 1
У завданні потрібно використати перелічені команди, щоб поекспериментуйте з максимальним лімітом ресурсів відкритих файлів. Потрібно виконати завдання з root-правами та без них.
```
$ ulimit -n
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3000
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3001
$ ulimit -n 2000
$ ulimit -n
$ ulimit -aS | grep "open files"
$ ulimit -aH | grep "open files"
$ ulimit -n 3000
```
##

Спершу виконаємо та подивимося результат команд з root-правами, оскільки це рівень доступу, який користувач отримує автоматично.

```docker run -it dockeraspz bash```

![image](https://github.com/user-attachments/assets/b418b8dd-bf68-4645-90cd-65eb63b57e80)

Ця команда дозволить нам переглянути результат запропонованих команд без root-прав
```docker run -it --user $USER dockeraspz bash```

![image](https://github.com/user-attachments/assets/8d84fcd6-5be1-488e-9897-6ae975cb81a0)

Порівнюючи результати виконання команд, помічаємо, що відмінності відсутні. Скоріше за все у завданні малося на увазі про привілейовані права доступу. Їх можна отримати використовуючи прапорець `--privileged`. Тоді й справді результат різнитиметься

![image](https://github.com/user-attachments/assets/bff620af-8c2f-43b5-85d2-bb3be3d3747d)

## Завдання 2

У Docker-контейнері встановіть утиліту perf(1). Поекспериментуйте з досягненням процесом встановленого ліміту.

##
У документації [seccomp докера](https://docs.docker.com/engine/security/seccomp/) зазначається, що системні виклики “perf*” і “ptrace” заборонено за замовчуванням з міркувань безпеки. Є декілька методів обійти цю заборону. Один з них запустити докер з прапорцем `--privileged`.

Далі потрібно докачати потрібні пакети у яких знаходиться команда `perf`. Встановити потрібну відповідну версію до вашого ядра. Визначаити її можна за допомогою наступної команди
```
uname -r
```
У мене довгий час не виходило розібратися чому убунта не хоче втановлювати певні пакети і не може їх алокувати. Я пробувала різні команди

```
apt install -y linux-tools-5.15.0-1078-iotg
apt-get install -y linux-tools-5.15.0-1078-iotg
apt-get install -y linux-cloud-tools-5.15.0-1078-iotg
apt install -y linux-tools-5.15.0-1078-generic
```
В терміналі, незважаючи на всі мої спроби, всерівно вибивало помилку, яка зазвичай була пов1язана з тим, що неможливо було алокувати пакети.

![image](https://github.com/user-attachments/assets/98c082b0-c531-497a-bbe7-c3488a44c8e4)

Після цього проблеми не зникли, оскільки якщо щось погане має статися воно обов'язково станеться. Для віртуалки не вистачалося місця, а після переміщення файлів на диск d, все взагалі перестало запускатися. Тому, що freebsd, що ubuntu потрібно було видалити та переустановити.

Я не визначила корінь проблеми, проте маю підозру, що це було пов'язано із зістарілою версією ядра, оскільки після оновлення усе запрацювало. Ось описані кроки після запуску докера

```
apt install -y sudo
apt install -y linux-tools-6.8.0-59-generic
sudo perf stat ls

```
Словами не описати як я зраділа цій помилці, адже це значило, що залишилося лише запустити докер в привілейованому стані

![image](https://github.com/user-attachments/assets/1b4a06bd-3165-465d-840c-782fe4d747ce)

```
docker run -it --privileged dockeraspz bash
sudo perf stat ls
```

![image](https://github.com/user-attachments/assets/9e7847c3-32c4-48f7-9f6b-212f198ad271)

Створимо файл з нескінченним циклом `while` для виконання завдання. Для того також потрібно буде доінсталювати gcc та nano.
```
#include <stdio.h>
int main(){
    while(1);
    return 0;
}
```
Скомпілюємо програму та запстимо її. Проте оскільки програма триває нескінченно нам потрібно прервати її, щоб отримати результат.
```
sudo perf stat ./lim
```
